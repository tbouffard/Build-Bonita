language: java
jdk: openjdk8
os: linux
dist: xenial

# for studio build
# see https://docs.travis-ci.com/user/gui-and-headless-browsers/#using-services
services:
  - xvfb

before_cache:
  # Maven: ensure that we do not keep bonitasoft artifacts across builds
  - rm -rf $HOME/.m2/repository/org/bonitasoft
  # Gradle: see https://docs.travis-ci.com/user/languages/java/#projects-using-gradle
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    # Maven dependencies and wrappers
    - $HOME/.m2
    # Gradle caches and wrapper
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/


branches:
  only:
  - master
  - dev

env:
  global:
    - BONITA_BUILD_NO_CLEAN=true

install:
  # openjdk11 should be installed
  # https://docs.travis-ci.com/user/reference/xenial/#jvm-clojure-groovy-java-scala-support
  - /usr/local/lib/jvm/openjdk11/bin/java --version
before_script:
  # copy maven toolchains.xml configuration file
  - ls -lh $HOME/.m2
  - cp  .travis/maven/toolchains.xml $HOME/.m2/
  - ls -lh $HOME/.m2

jobs:
  include:
    - stage: build without studio
      env:
        - BONITA_BUILD_QUIET=true
        - BONITA_BUILD_STUDIO_SKIP=true
#      script: ./build-script.sh
      script:
        - echo "simulate build without studio"
        - ls -lh $HOME/.m2
        - ls -lh $HOME/.m2/repository
        - ls -lh $HOME/.m2/repository/org
    - stage: build studio
      env:
        - BONITA_BUILD_STUDIO_ONLY=true
        - BONITA_BUILD_QUIET=false
#      script: ./build-script.sh
      script:
        - echo "simulate build without studio"
        - ls -lh $HOME/.m2
        - ls -lh $HOME/.m2/repository
        - ls -lh $HOME/.m2/repository/org
